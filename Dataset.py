import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA

class DATASET:
    def __init__(self, file_path):
        self.file_path = file_path
        self.data = None
        self.labels = None

    def load_dataset(self):
        try:
            self.data = pd.read_csv(self.file_path)
            if 'label' in self.data.columns:
                self.labels = self.data['label']
                # self.data = self.data.drop(columns=['label'])
            print(f"Dataset loaded successfully from {self.file_path}")
        except Exception as e:
            print(f"Failed to load dataset: {e}")

    def process(self):
        if self.data is not None:
            print("Processing dataset...")
            # Fill missing values with 0
            self.data.fillna(0, inplace=True)
            # Normalize the dataset
            scaler = StandardScaler()
            self.data = pd.DataFrame(scaler.fit_transform(self.data), columns=self.data.columns)
        else:
            print("No data to process. Please load the dataset first.")

    def visualize(self):
        if self.data is not None and self.labels is not None:
            print("Visualizing dataset with PCA:")
            pca = PCA(n_components=2)
            principal_components = pca.fit_transform(self.data)
            pca_df = pd.DataFrame(data=principal_components, columns=['PC1', 'PC2'])
            pca_df['label'] = self.labels

            plt.figure(figsize=(8, 6))
            sns.scatterplot(x='PC1', y='PC2', hue='label', data=pca_df, palette=['blue', 'red'])
            plt.title('PCA of Dataset')
            plt.xlabel('Principal Component 1')
            plt.ylabel('Principal Component 2')
            plt.show()
        else:
            print("No data to visualize or labels are missing. Please load and process the dataset first.")

    def get_summary(self):
        if self.data is not None:
            return self.data.describe()
        else:
            print("No data available. Please load the dataset first.")
            return None

    def get_head(self, n=5):
        if self.data is not None:
            return self.data.head(n)
        else:
            print("No data available. Please load the dataset first.")
            return None

    def save_dataset(self, output_path):
        if self.data is not None:
            try:
                self.data.to_csv(output_path, index=False)
                print(f"Dataset saved successfully to {output_path}")
            except Exception as e:
                print(f"Failed to save dataset: {e}")
        else:
            print("No data to save. Please load and process the dataset first.")
